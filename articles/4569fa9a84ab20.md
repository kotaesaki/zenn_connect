---
title: "Server Componentsã¯ãªãœlocalStorageã«å‚ç…§ã§ããªã„ã®ã«ã€cookieã«ã¯å‚ç…§ã§ãã‚‹ã®ã‹"
emoji: "ğŸ¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["react", "nextjs", "approuter"]
published: true
---

# ã¯ã˜ã‚ã«

Next.jsã§App Routerã‚’æœ¬æ ¼çš„ã«è§¦ã‚Šå§‹ã‚ã¾ã—ãŸã€‚
Server Components(ä»¥ä¸‹SC)ã«é–¢ã—ã¦ã¯ã“ã“ã§ã¯è©³ç´°ã«èª¬æ˜ã—ã¾ã›ã‚“ãŒã€ã‚µãƒ¼ãƒãƒ¼ä¸Šã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚ãƒãƒ³ãƒ‰ãƒ«ã‚µã‚¤ã‚ºã®ç¸®å°ã‚„èµ·å‹•æ™‚é–“ã®çŸ­ç¸®ãªã©ãŒæœŸå¾…ã•ãŸã‚Šã™ã‚‹æ©æµãŒã‚ã‚Šã¾ã™ã€‚

ãã‚“ãªä¸­ã§`cookie`ã‚’SCã‹ã‚‰å‘¼ã³å‡ºã™ãŸã‚ã®functionãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://nextjs.org/docs/app/building-your-application/data-fetching/fetching#server-component-functions

ç§ã¨ã—ã¦ã¯`localStorage`ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ã¦ã‚µãƒ¼ãƒã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰å‘¼ã³å‡ºã—ãŸã‹ã£ãŸã®ã§ã™ãŒã€ã©ã†ã‚„ã‚‰ãã‚ŒãŒã§ããªã„ã¿ãŸã„ã§ã—ãŸã€‚ğŸ¤”

ãªãœcookieã¯å–å¾—ã§ãã¦ã€`localStorage`ã¯å–å¾—ã§ããªã„ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

# ãã‚‚ãã‚‚cookieã¨localStorageã®é•ã„ã¨ã¯ï¼Ÿ
`cookie`ã¨`localStorage`ã®å¤§ããªé•ã„ã¨ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ãŒç•°ãªã‚‹ç‚¹ã§ã™ã€‚

`cookie`ã¯ã€ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã¾ã‚Œã‚‹æƒ…å ±ã§ã‚ã‚Šã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚`cookie`ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒåŒã˜ã‚µãƒ¼ãƒãƒ¼ã«å¯¾ã—ã¦å¾Œç¶šã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹éš›ã«ã€ã‚µãƒ¼ãƒãƒ¼ã«å¯¾ã—ã¦æƒ…å ±ã‚’æä¾›ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ã¾ãŸæœ‰åŠ¹æœŸé™ã‚„ãƒ‰ãƒ¡ã‚¤ãƒ³ã®åˆ¶ç´„ãªã©ã®è¨­å®šã‚’æŒã¤ã“ã¨ãŒã§ããŸã‚Šã€ã‚»ã‚­ãƒ¥ã‚¢ãƒ•ãƒ©ã‚°ã‚’è¨­å®šã™ã‚‹ã“ã¨ã§HTTPSæ¥ç¶šã®ã¿ã§`cookie`ã‚’é€ä¿¡ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/HTTP/Cookies


ä¸€æ–¹ã€`localStorage`ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ãŸã ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã§ã™ã€‚`localStorage`ã¯ã€ã‚­ãƒ¼ã¨å€¤ã®ãƒšã‚¢ã‚’ä¿å­˜ã™ã‚‹ã“ã¨ãŒã§ãã€JavaScriptã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿æ›¸ããŒã§ãã¾ã™ã€‚ãŸã ã—ã€`localStorage`ã«ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã¯ã€åŒã˜ãƒ‰ãƒ¡ã‚¤ãƒ³å†…ã®ã™ã¹ã¦ã®ãƒšãƒ¼ã‚¸ã§å…±æœ‰ã•ã‚Œã¾ã™ã€‚

`cookie`ã¯HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ä¸€éƒ¨ã¨ã—ã¦é€ä¿¡ã•ã‚Œã¾ã™ãŒã€`localStorage`ã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚

# ServerComponentsã§ã¯ãªãœlocalStorageãŒå–å¾—ã§ããªã„ã®ã‹
ãƒ–ãƒ©ã‚¦ã‚¶ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã®ãŸã ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã ã‹ã‚‰ã§ã™ã€‚ã‚µãƒ¼ãƒãƒ¼å´ã‹ã‚‰å–å¾—ã™ã‚‹ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚


ãã‚‚ãã‚‚SCã¨ã¯ä»®æƒ³DOMã‚’è¿”å´ã™ã‚‹HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™ã€‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã‚µãƒ¼ãƒã«HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ã€ã‚µãƒ¼ãƒã‹ã‚‰ä»®æƒ³DOMã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦å—ã‘ã¨ã‚‹ã‚ˆã†ãªä»•çµ„ã¿ã§ã™ã€‚ãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã«ã¯ã‚‚ã¡ã‚ã‚“`localStorage`ã®æƒ…å ±ã¯æ¸¡ã—ã¦ã„ã¾ã›ã‚“ã€‚

![](/images/20230623_2.png)
> å‚ç…§: https://qiita.com/naruto/items/c17c79ec5c2a0c7c4686
ã“ã®å›³ãŒã‚ã‹ã‚Šã‚„ã™ã‹ã£ãŸã®ã§ä½¿ã‚ã›ã¦ã„ãŸã ãã¾ã™ğŸ™‡

# ã§ã¯ãªãœcookieãŒå–å¾—ã§ãã‚‹ã®ã‹
SCã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹éš›ã«ã€`cookie`ã‚’æ¸¡ã—ã¦ã„ã‚‹ã“ã¨ãŒäºˆæƒ³ã§ãã¾ã™ã€‚
ãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã‚’[cookies()](https://nextjs.org/docs/app/building-your-application/data-fetching/fetching#server-component-functions)ã®geté–¢æ•°ãªã©ã§å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ã‹ãªã¨ã€‚

![](/images/20230623_1.png)

(è©³ã—ã„æ–¹ã„ãŸã‚‰æ•™ãˆã¦ãã ã•ã„ï¼)

# å‚è€ƒ
https://github.com/reactjs/rfcs/blob/main/text/0188-server-components.md
https://qiita.com/naruto/items/c17c79ec5c2a0c7c4686

